<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>LineIntersect</title>
        <script src="util.js"></script>
        <script src="libs/dat.gui.js"></script>
        <script type="text/javascript" src="Point.js"></script>
        <script>
        
        function Point(x,y){
            this.x = x;
            this.y = y;
        }
        /*
            输入：
            point1:位于第一条直线上的一个2D点；
            scope1:第一条直线的斜率
            point2:位于第二条直线上的一个2D点
            scope2:第二条直线的斜率
            输出：相交的点
        */
        function line_intersect(point1,scope1,point2,scope2){
            var x = (scope1*point1.x - scope2*point2.x + point2.y - point1.y) / (scope1 - scope2);
            var y = scope1 * (x - point1.x) + point1.y;
            return new Point(Math.ceil(x),Math.ceil(y));
        }
        </script>
    </head>
    <body>
        <canvas id="myCanvas" style="border:1px solid #000" width="400" height="400"></canvas>
        <script>
           var controls = new function() {
                this.point1x = 0;
                this.point1y = 75;
                this.point2x = 400;
                this.point2y = 250;

                this.point3x = 50;
                this.point3y = 0;
                this.point4x = 150;
                this.point4y = 400;
            }

            var gui = new dat.GUI();
            gui.add(controls, 'point1x',-10000,0);
            gui.add(controls, 'point1y',0,400);
            gui.add(controls, 'point2x',400,10000);
            gui.add(controls, 'point2y',0,400);
            gui.add(controls, 'point3x',0,600);
            gui.add(controls, 'point3y',-10000,0);
            gui.add(controls, 'point4x',0,400);
            gui.add(controls, 'point4y',400,1000);


            var canvas = document.getElementById("myCanvas");
            var ctx = canvas.getContext("2d");
            function draw(){
                var point1 = new Point(controls.point1x,controls.point1y);
                var point2 =  new Point(controls.point2x,controls.point2y);

                var point3 = new Point(controls.point3x,controls.point3y);
                var point4 =  new Point(controls.point4x,controls.point4y);

                ctx.beginPath();
                ctx.lineWidth = "5";
                ctx.strokeStyle = "red";
                ctx.moveTo(point1.x, point1.y);
                ctx.lineTo(point2.x, point2.y);
                ctx.stroke();

                ctx.beginPath();
                ctx.strokeStyle = "blue";
                ctx.moveTo(point3.x, point3.y);
                ctx.lineTo(point4.x, point4.y);
                ctx.stroke();

                var scope1 = (point2.y - point1.y) / (point2.x - point1.x);
                var scope2 = (point4.y - point3.y) / (point4.x - point3.x);

                var intersectPoint = line_intersect(point1, scope1, point3, scope2);
                var x = intersectPoint.x;
                var y = intersectPoint.y;
                ctx.beginPath();
                ctx.arc(x, y, 10, 0, 2 * Math.PI);
                ctx.fillStyle = "green";
                ctx.fill();

                ctx.font="20px Georgia";
                ctx.fillText(x+','+y ,x+10,y);
            }
            window.onload = function() {
                (function animloop(){
                      ctx.clearRect(0,0,canvas.width,canvas.height);
                      requestAnimFrame(animloop);
                      draw();
                })();
            };
        </script>
    </body>
</html>